<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-wrapper">
        <nav class="navbar navbar-expand-lg mb-4">
          <div class="container-fluid">
            <button class="btn btn-outline-secondary me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar">
              â˜°
            </button>
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('dashboard') }}">ðŸ“Š TrackIt</a>
            <div class="navbar-nav ms-auto">
              <a class="btn btn-success me-2" href="{{ url_for('add_transaction') }}">âž• Add Transaction</a>
            </div>
          </div>
        </nav>

        <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="sidebarLabel" style="color: white;">ðŸ“Š TrackIt</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <div class="list-group list-group-flush bg-transparent">
              <a href="/dashboard" class="list-group-item list-group-item-action active bg-transparent text-white border-0">
                <img src="https://img.icons8.com/fluency/24/ffffff/dashboard.png" alt="Dashboard" class="me-2"> Dashboard
              </a>
              <a href="/transactions" class="list-group-item list-group-item-action bg-transparent text-white border-0">
                <img src="https://img.icons8.com/fluency/24/ffffff/list.png" alt="Transactions" class="me-2"> All Transaction
              </a>
              <a href="/report" class="list-group-item list-group-item-action bg-transparent text-white border-0">
                <img src="https://img.icons8.com/fluency/24/ffffff/combo-chart.png" alt="Report" class="me-2"> Report
              </a>
            </div>
          </div>
        </div>

        <div class="text-center mb-5">
            <img src="https://img.icons8.com/fluency/96/000000/money-bag.png" alt="Money Bag" class="mb-3">
            <h1>Welcome to TrackIt</h1>
            <p class="text-muted">Track your finances with ease and style</p>
        </div>

        <!-- SUMMARY CARDS -->
        <div class="row text-center mb-5">
          <div class="col-md-3">
            <div class="card border-success">
              <div class="card-body">
                <img src="https://img.icons8.com/fluency/48/28a745/money.png" alt="Income" class="mb-2">
                <h5>Total Income</h5>
                <h4 class="text-success">â‚¹{{ total_income }}</h4>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-danger">
              <div class="card-body">
                <img src="https://img.icons8.com/fluency/48/e74c3c/expensive.png" alt="Expense" class="mb-2">
                <h5>Total Expense</h5>
                <h4 class="text-danger">â‚¹{{ total_expense }}</h4>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-primary">
              <div class="card-body">
                <img src="https://img.icons8.com/fluency/48/3498db/wallet.png" alt="Balance" class="mb-2">
                <h5>Balance</h5>
                <h4 class="text-primary">â‚¹{{ balance }}</h4>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card border-warning">
              <div class="card-body">
                <img src="https://img.icons8.com/fluency/48/f39c12/calendar.png" alt="Today" class="mb-2">
                <h5>Today's Expense</h5>
                <h4 class="text-warning">â‚¹{{ today_expense }}</h4>
              </div>
            </div>
          </div>
        </div>

<hr>

<!-- CHARTS -->
<div class="text-center mb-4">
    <img src="https://img.icons8.com/fluency/64/000000/combo-chart.png" alt="Chart Icon" class="mb-2">
    <h2>Expense Analysis</h2>
    <p class="text-muted">Visualize your spending patterns and trends</p>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Category Breakdown</h5>
      </div>
      <div class="card-body">
        <canvas id="pieChart" height="100"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Daily Trends</h5>
      </div>
      <div class="card-body">
        <canvas id="lineChart" height="100"></canvas>
      </div>
    </div>
  </div>
</div>

<hr>

<!-- RECENT TRANSACTIONS -->
<h2>Recent Transactions</h2>

<div class="table-responsive">
    <table class="table table-bordered table-striped mt-3">
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Type</th>
        </tr>

        {% for e in recent %}
        <tr>
            <td>{{ e.date }}</td>
            <td>{{ e.description }}</td>
            <td>{{ e.category }}</td>
            <td>â‚¹{{ e.amount }}</td>
            <td>{{ e.type }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- CHART SCRIPT -->
<script>
    const categories = {{ categories | tojson }};
    const categoryAmounts = {{ category_amounts | tojson }};
    const dates = {{ dates | tojson }};
    const dailyAmounts = {{ daily_amounts | tojson }};
    const monthlyIncomeLabels = {{ monthly_income_labels | tojson }};
    const monthlyIncomeAmounts = {{ monthly_income_amounts | tojson }};

    if (categories.length > 0) {
        new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    data: categoryAmounts,
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF',
                        '#FF9F40'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });
    }

    if (dates.length > 0) {
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Daily Expense',
                    data: dailyAmounts,
                    fill: false,
                    tension: 0.3,
                    borderColor: '#FF6384',
                    backgroundColor: '#FF6384'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    if (monthlyIncomeLabels.length > 0) {
        new Chart(document.getElementById('monthlyIncomeChart'), {
            type: 'bar',
            data: {
                labels: monthlyIncomeLabels,
                datasets: [{
                    label: 'Monthly Income',
                    data: monthlyIncomeAmounts,
                    backgroundColor: '#36A2EB',
                    borderColor: '#36A2EB',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
</script>

            </div>
        </div>
    </div>
</body>
</html>
